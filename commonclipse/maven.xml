<?xml version="1.0" encoding="UTF-8"?>
<project default="rebuild-all" xmlns:m="maven" xmlns:j="jelly:core" xmlns:u="jelly:util">

	<goal name="rebuild-all">
		<j:set var="goals" value="clean,jar:jar,eclipseplugin:zip,site:generate" />
		<mkdir dir="${maven.build.dir}" />
		<u:tokenize var="goals" delim=",">${goals}</u:tokenize>
		<j:forEach items="${goals}" var="goal" indexVar="goalNumber">
			Now attaining goal number ${goalNumber}, which is ${goal}
			<attainGoal name="${goal}" />
		</j:forEach>
	</goal>

    <goal name="eclipseplugin:zip">
          <zip destfile="${maven.build.dir}/${pom.name}-src.zip">
              <zipfileset dir="${maven.src.dir}/main"/>
          </zip>
          <zip destfile="${maven.build.dir}/${pom.name}-${pom.currentVersion}.zip">
              <zipfileset dir="${maven.build.dir}" includes="${maven.final.name}.jar,${pom.name}-src.zip" prefix="${pom.package}_${pom.currentVersion}"/>
              <zipfileset dir="${maven.base.dir}" includes="plugin.*,icons/*,LICENSE.txt" prefix="${pom.package}_${pom.currentVersion}"/>
          </zip>
    </goal>
    
    <preGoal name="site:sshdeploy">
		<attainGoal name="updatesite" />
	</preGoal>
    
    <goal name="updatesite">
         <!-- copy site.xml -->
        <copy file="${maven.src.dir}/update/site.xml" todir="${maven.build.dir}/docs" />
		<!-- zip feature -->
		<zip destfile="${maven.build.dir}/docs/commonclipse.jar">
              <zipfileset dir="${maven.src.dir}/feature"/>
        </zip>
        <!-- copy plugin -->
         <copy file="${maven.build.dir}/${maven.final.name}.jar" tofile="${maven.build.dir}/docs/plugins/net.sf.commonclipse_${pom.currentVersion}.jar" />

    </goal>
    
      
</project>
